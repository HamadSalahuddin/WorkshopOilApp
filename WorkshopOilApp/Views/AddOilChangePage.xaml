<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:WorkshopOilApp.ViewModels"
             x:Class="WorkshopOilApp.Views.AddOilChangePage"
             Title="New Oil Change"
             BackgroundColor="#F8FAFC">

    <ContentPage.BindingContext>
        <vm:AddOilChangeViewModel />
    </ContentPage.BindingContext>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Vehicle Info Card -->
            <Frame BackgroundColor="White" CornerRadius="16" HasShadow="True" Padding="20">
                <VerticalStackLayout Spacing="10">
                    <Label Text="{Binding Vehicle.FullModel}" FontSize="22" FontAttributes="Bold" />
                    <Label Text="{Binding Vehicle.RegistrationNumber}" FontSize="16" TextColor="#64748B" />
                    <Label Text="{Binding CustomerName}" FontSize="15" TextColor="#475569" />
                </VerticalStackLayout>
            </Frame>

            <!-- Oil Selection -->
            <Frame BackgroundColor="White" CornerRadius="16" HasShadow="True" Padding="15">
                <Grid RowDefinitions="Auto,Auto" ColumnDefinitions="100,*">
                    <Label Text="Oil Type:" Grid.Row="0" Grid.Column="0" FontAttributes="Bold" VerticalOptions="Center" />
                    <Picker Grid.Row="0" Grid.Column="1"
                            ItemsSource="{Binding AvailableLubricants}"
                            ItemDisplayBinding="{Binding DisplayName}"
                            SelectedItem="{Binding SelectedLubricant}" />

                    <Label Text="Date:" Grid.Row="1" Grid.Column="0" FontAttributes="Bold" VerticalOptions="Center" Margin="0,10,0,0" />
                    <DatePicker Grid.Row="1" Grid.Column="1" Date="{Binding ChangeDate}" Margin="0,10,0,0" />
                </Grid>
            </Frame>

            <!-- Mileage & Cost -->
            <Frame BackgroundColor="White" CornerRadius="16" HasShadow="True" Padding="15">
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" RowSpacing="15">
                    <Label Text="Mileage:" FontAttributes="Bold" VerticalOptions="Center" />
                    <Entry Text="{Binding Mileage}" Keyboard="Numeric" Grid.Column="1" />

                    <Label Text="Cost (optional):" FontAttributes="Bold" Grid.Row="1" VerticalOptions="Center" />
                    <Entry Text="{Binding Cost}" Keyboard="Numeric" Placeholder="e.g. 85.00" Grid.Row="1" Grid.Column="1" />
                </Grid>
            </Frame>

            <!-- Next Due Calculation -->
            <Frame BackgroundColor="#EFF6FF" CornerRadius="16" Padding="15">
                <VerticalStackLayout Spacing="10">
                    <Label Text="Next Service Due:" FontSize="18" FontAttributes="Bold" TextColor="#1E40AF" />
                    <Label Text="{Binding NextDueText}" FontSize="20" TextColor="#1D4ED8" />
                    <Label Text="{Binding NextDueDateString}" FontSize="16" TextColor="#1E40AF" />
                </VerticalStackLayout>
            </Frame>

            <!-- Notes -->
            <Frame BackgroundColor="White" CornerRadius="16" HasShadow="True">
                <Editor Placeholder="Notes (filter, driving conditions, etc.)"
                        Text="{Binding Notes}"
                        HeightRequest="100" />
            </Frame>

            <!-- Save Button -->
            <Button Text="Save Oil Change"
                    Command="{Binding SaveCommand}"
                    BackgroundColor="#10B981"
                    TextColor="White"
                    CornerRadius="16"
                    HeightRequest="56"
                    FontSize="18"
                    FontAttributes="Bold"
                    IsEnabled="{Binding IsNotBusy}">
                <Button.Shadow>
                    <Shadow Brush="#10B981" Opacity="0.4" Radius="12" Offset="0,6"/>
                </Button.Shadow>
            </Button>

            <!-- Loading / Success -->
            <Label Text="{Binding Message}"
                   TextColor="{Binding MessageColor}"
                   FontSize="16"
                   HorizontalOptions="Center"
                   IsVisible="{Binding HasMessage}" />

            <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" Color="#10B981" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>