<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:WorkshopOilApp.ViewModels"
             x:Class="WorkshopOilApp.Views.ForgotPasswordPage"
             Title="Reset Password"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark={StaticResource Gray950}}"
             x:DataType="vm:ForgotPasswordViewModel">

    <ContentPage.BindingContext>
        <vm:ForgotPasswordViewModel />
    </ContentPage.BindingContext>

    <ScrollView>
        <VerticalStackLayout Padding="30" Spacing="25" VerticalOptions="CenterAndExpand">

            <!-- Header -->
            <VerticalStackLayout Spacing="10" HorizontalOptions="Center">
                <Label Text="&#xE897;" 
                       FontFamily="MaterialIcons" 
                       FontSize="80" 
                       TextColor="#3B82F6" />
                <Label Text="Forgot Password?" 
                       FontSize="28" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center"
                       TextColor="#1E293B" />
                <Label Text="Enter your username and recovery passcode"
                       FontSize="16"
                       TextColor="#64748B"
                       HorizontalOptions="Center" />
            </VerticalStackLayout>

            <!-- Username -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}" CornerRadius="12" HasShadow="True" Padding="15">
                <Grid ColumnDefinitions="50,*">
                    <Label Text="&#xE7FD;" FontFamily="MaterialIcons" FontSize="24" TextColor="#64748B" VerticalOptions="Center" />
                    <Entry Placeholder="Username" 
                           Text="{Binding Username}"
                           Grid.Column="1" />
                </Grid>
            </Frame>

            <!-- Passcode -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}" CornerRadius="12" HasShadow="True" Padding="15">
                <Grid ColumnDefinitions="50,*">
                    <Label Text="&#xE32A;" FontFamily="MaterialIcons" FontSize="24" TextColor="#64748B" VerticalOptions="Center" />
                    <Entry Placeholder="Recovery Passcode" 
                           IsPassword="True"
                           Text="{Binding Passcode}"
                           Grid.Column="1" />
                </Grid>
            </Frame>

            <!-- New Password -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}" CornerRadius="12" HasShadow="True" Padding="15">
                <Grid ColumnDefinitions="50,*">
                    <Label Text="&#xE897;" FontFamily="MaterialIcons" FontSize="24" TextColor="#64748B" VerticalOptions="Center" />
                    <Entry Placeholder="New Password" 
                           IsPassword="True"
                           Text="{Binding NewPassword}"
                           Grid.Column="1"
                           IsVisible="{Binding ShowNewPasswordFields}" />
                </Grid>
            </Frame>

            <!-- Confirm Password -->
            <Frame BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray900}}" CornerRadius="12" HasShadow="True" Padding="15" IsVisible="{Binding ShowNewPasswordFields}">
                <Grid ColumnDefinitions="50,*">
                    <Label Text="&#xE897;" FontFamily="MaterialIcons" FontSize="24" TextColor="#64748B" VerticalOptions="Center" />
                    <Entry Placeholder="Confirm New Password" 
                           IsPassword="True"
                           Text="{Binding ConfirmPassword}"
                           Grid.Column="1" />
                </Grid>
            </Frame>

            <!-- Success Message -->
            <Label Text="Password changed successfully! You can now log in."
                   TextColor="#10B981"
                   FontSize="16"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   IsVisible="{Binding ShowSuccessMessage}" />

            <!-- Error Message -->
            <Label Text="{Binding ErrorMessage}" 
                   TextColor="#EF4444" 
                   FontSize="15"
                   HorizontalOptions="Center"
                   IsVisible="{Binding HasError}" />

            <!-- Submit Button -->
            <Button Text="{Binding SubmitButtonText}"
                    Command="{Binding SubmitCommand}"
                    BackgroundColor="#3B82F6"
                    TextColor="White"
                    CornerRadius="12"
                    HeightRequest="55"
                    FontSize="18"
                    FontAttributes="Bold"
                    IsEnabled="{Binding IsNotBusy}">

                <Button.Shadow>
                    <Shadow Brush="#3B82F6" Opacity="0.3" Radius="10" Offset="0,5"/>
                </Button.Shadow>
            </Button>

            <!-- Back to Login -->
            <Label HorizontalOptions="Center">
                <Label.FormattedText>
                    <FormattedString>
                        <Span Text="Remembered your password? " TextColor="#64748B" />
                        <Span Text="Back to Login"
                              TextColor="#3B82F6"
                              FontAttributes="Bold">
                            <Span.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding GoBackToLoginCommand}" />
                            </Span.GestureRecognizers>
                        </Span>
                    </FormattedString>
                </Label.FormattedText>
            </Label>

            <!-- Loading -->
            <ActivityIndicator IsRunning="{Binding IsBusy}" 
                               IsVisible="{Binding IsBusy}"
                               Color="#3B82F6"
                               HorizontalOptions="Center" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>